<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Zend\View Quick Start &mdash; Zend Framework 2 2.3.0dev documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.3.0dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Zend Framework 2 2.3.0dev documentation" href="../index.html" />
    <link rel="next" title="The PhpRenderer" href="zend.view.renderer.php-renderer.html" />
    <link rel="prev" title="Getting the Zend Framework Version" href="zend.version.html" />
<style type="text/css">
    /* Styles for floating Edit on GitHub box */
    #editor-trap {
        padding: 1em;
        border: 1px solid white;
        width: 250px;

        display: none;
        color: white;
        background: #3f454b;
        position: fixed;
        bottom: 5px;
        left: 175px;
        font-size: 85%;
        text-align: left;
        z-index: 2;

        box-shadow: 0 4px 6px #333;
        -moz-box-shadow: 0 4px 6px #333;
        -webkit-box-shadow: 0 4px 6px #333;
        
        cursor: pointer;
    }

    #editor-trap h3 {
        margin: 0 0 0.5em 0;
        padding: 0;
    }

    #editor-trap h3 > span {
        padding: 0 6px;
        border: solid white;
        border-width: 0 1px 4px 1px;
        font-size: 10px;
    }

    #editor-trap a {
        color: #98DBCC;
    }

    #editor-trap ol {
        margin: 0;
        padding: 0 0 0 2em;
    }

    /* Hide trick */
    #editor-trap.toggled > * {
        display: none;
    }


    #editor-trap.toggled > h3 {
        display: block;
    }

    #editor-trap.toggled > h3 > span {
        border-width: 6px 1px 0 1px;
    }
    
    #edit-button {
        position: fixed;
        bottom: 5px;
        left: 5px;
        z-index: 2;
        width: 162px;
        height: 42px;
    }
</style>

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="zend.view.renderer.php-renderer.html" title="The PhpRenderer"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="zend.version.html" title="Getting the Zend Framework Version"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Zend Framework 2 2.3.0dev documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="zend-view-quick-start">
<span id="id1"></span><h1>Zend\View Quick Start<a class="headerlink" href="#zend-view-quick-start" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<span id="zend-view-quick-start-intro"></span><h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">Zend\View</span></tt> provides the &#8220;View&#8221; layer of Zend Framework 2&#8217;s MVC system. It is a multi-tiered system allowing a
variety of mechanisms for extension, substitution, and more.</p>
<p>The components of the view layer are as follows:</p>
<ul class="simple">
<li><strong>Variables Containers</strong> hold variables and callbacks that you wish to represent in the view. Often-times,
a Variables Container will also provide mechanisms for context-specific escaping of variables and more.</li>
<li><strong>View Models</strong> hold Variables Containers, specify the template to use (if any), and optionally provide
rendering options (more on that below). View Models may be nested in order to represent complex structures.</li>
<li><strong>Renderers</strong> take View Models and provide a representation of them to return. Zend Framework 2 ships with three
renderers by default: a <tt class="docutils literal"><span class="pre">PhpRenderer</span></tt> which utilizes PHP templates in order to generate markup, a <tt class="docutils literal"><span class="pre">JsonRenderer</span></tt>,
and a <tt class="docutils literal"><span class="pre">FeedRenderer</span></tt> for generating RSS and Atom feeds.</li>
<li><strong>Resolvers</strong> utilizes Resolver Strategies to resolve a template name to a resource a Renderer may consume.
As an example, a Resolver may take the name &#8220;blog/entry&#8221; and resolve it to a PHP view script.</li>
<li>The <strong>View</strong> consists of strategies that map the current Request to a Renderer, and strategies for
injecting the result of rendering to the Response.</li>
<li><strong>Rendering Strategies</strong> listen to the <tt class="docutils literal"><span class="pre">Zend\View\ViewEvent::EVENT_RENDERER</span></tt> event of the View and decide which
Renderer should be selected based on the Request or other criteria.</li>
<li><strong>Response Strategies</strong> are used to inject the Response object with the results of rendering.
That may also include taking actions such as setting Content-Type headers.</li>
</ul>
<p>Additionally, Zend Framework 2 provides integration with the MVC via a number of event listeners in the
<tt class="docutils literal"><span class="pre">Zend\Mvc\View</span></tt> namespace.</p>
</div>
<div class="section" id="usage">
<span id="zend-view-quick-start-usage"></span><h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>This section of the manual is designed to show you typical usage patterns of the view layer when using it within
the Zend Framework 2 MVC. The assumptions are that you are using <a class="reference internal" href="../index.html#zend-di"><em>Dependency Injection</em></a> and the
default MVC view strategies.</p>
<div class="section" id="configuration">
<span id="zend-view-quick-start-usage-config"></span><h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h3>
<p>The default configuration will typically work out-of-the-box. However, you will still need to
select Resolver Strategies and configure them, as well as potentially indicate alternate template names for things
like the site layout, 404 (not found) pages, and error pages. The code snippets below can be added to your
configuration to accomplish this. We recommend adding it to a site-specific module, such as the &#8220;Application&#8221;
module from the framework&#8217;s <a class="reference external" href="https://github.com/zendframework/ZendSkeletonApplication">ZendSkeletonApplication</a>, or to one of your autoloaded configurations within the
<tt class="docutils literal"><span class="pre">config/autoload/</span></tt> directory.</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">return</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;view_manager&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="c1">// The TemplateMapResolver allows you to directly map template names</span>
        <span class="c1">// to specific templates. The following map would provide locations</span>
        <span class="c1">// for a home page template (&quot;application/index/index&quot;), as well as for</span>
        <span class="c1">// the layout (&quot;layout/layout&quot;), error pages (&quot;error/index&quot;), and</span>
        <span class="c1">// 404 page (&quot;error/404&quot;), resolving them to view scripts.</span>
        <span class="s1">&#39;template_map&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;application/index/index&#39;</span> <span class="o">=&gt;</span> <span class="nx">__DIR__</span> <span class="o">.</span>  <span class="s1">&#39;/../view/application/index/index.phtml&#39;</span><span class="p">,</span>
            <span class="s1">&#39;site/layout&#39;</span>             <span class="o">=&gt;</span> <span class="nx">__DIR__</span> <span class="o">.</span> <span class="s1">&#39;/../view/layout/layout.phtml&#39;</span><span class="p">,</span>
            <span class="s1">&#39;error/index&#39;</span>             <span class="o">=&gt;</span> <span class="nx">__DIR__</span> <span class="o">.</span> <span class="s1">&#39;/../view/error/index.phtml&#39;</span><span class="p">,</span>
            <span class="s1">&#39;error/404&#39;</span>               <span class="o">=&gt;</span> <span class="nx">__DIR__</span> <span class="o">.</span> <span class="s1">&#39;/../view/error/404.phtml&#39;</span><span class="p">,</span>
        <span class="p">),</span>

        <span class="c1">// The TemplatePathStack takes an array of directories. Directories</span>
        <span class="c1">// are then searched in LIFO order (it&#39;s a stack) for the requested</span>
        <span class="c1">// view script. This is a nice solution for rapid application</span>
        <span class="c1">// development, but potentially introduces performance expense in</span>
        <span class="c1">// production due to the number of static calls necessary.</span>
        <span class="c1">//</span>
        <span class="c1">// The following adds an entry pointing to the view directory</span>
        <span class="c1">// of the current module. Make sure your keys differ between modules</span>
        <span class="c1">// to ensure that they are not overwritten -- or simply omit the key!</span>
        <span class="s1">&#39;template_path_stack&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;application&#39;</span> <span class="o">=&gt;</span> <span class="nx">__DIR__</span> <span class="o">.</span> <span class="s1">&#39;/../view&#39;</span><span class="p">,</span>
        <span class="p">),</span>

        <span class="c1">// This will be used as the default suffix for template scripts resolving, it defaults to &#39;phtml&#39;.</span>
        <span class="s1">&#39;default_template_suffix&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;php&#39;</span><span class="p">,</span>

        <span class="c1">// Set the template name for the site&#39;s layout.</span>
        <span class="c1">//</span>
        <span class="c1">// By default, the MVC&#39;s default Rendering Strategy uses the</span>
        <span class="c1">// template name &quot;layout/layout&quot; for the site&#39;s layout.</span>
        <span class="c1">// Here, we tell it to use the &quot;site/layout&quot; template,</span>
        <span class="c1">// which we mapped via the TemplateMapResolver above.</span>
        <span class="s1">&#39;layout&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;site/layout&#39;</span><span class="p">,</span>

        <span class="c1">// By default, the MVC registers an &quot;exception strategy&quot;, which is</span>
        <span class="c1">// triggered when a requested action raises an exception; it creates</span>
        <span class="c1">// a custom view model that wraps the exception, and selects a</span>
        <span class="c1">// template. We&#39;ll set it to &quot;error/index&quot;.</span>
        <span class="c1">//</span>
        <span class="c1">// Additionally, we&#39;ll tell it that we want to display an exception</span>
        <span class="c1">// stack trace; you&#39;ll likely want to disable this by default.</span>
        <span class="s1">&#39;display_exceptions&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
        <span class="s1">&#39;exception_template&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;error/index&#39;</span><span class="p">,</span>

       <span class="c1">// Another strategy the MVC registers by default is a &quot;route not</span>
       <span class="c1">// found&quot; strategy. Basically, this gets triggered if (a) no route</span>
       <span class="c1">// matches the current request, (b) the controller specified in the</span>
       <span class="c1">// route match cannot be found in the service locator, (c) the controller</span>
       <span class="c1">// specified in the route match does not implement the DispatchableInterface</span>
       <span class="c1">// interface, or (d) if a response from a controller sets the</span>
       <span class="c1">// response status to 404.</span>
       <span class="c1">//</span>
       <span class="c1">// The default template used in such situations is &quot;error&quot;, just</span>
       <span class="c1">// like the exception strategy. Here, we tell it to use the &quot;error/404&quot;</span>
       <span class="c1">// template (which we mapped via the TemplateMapResolver, above).</span>
       <span class="c1">//</span>
       <span class="c1">// You can opt in to inject the reason for a 404 situation; see the</span>
       <span class="c1">// various `Application\:\:ERROR_*`_ constants for a list of values.</span>
       <span class="c1">// Additionally, a number of 404 situations derive from exceptions</span>
       <span class="c1">// raised during routing or dispatching. You can opt-in to display</span>
       <span class="c1">// these.</span>
       <span class="s1">&#39;display_not_found_reason&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
       <span class="s1">&#39;not_found_template&#39;</span>       <span class="o">=&gt;</span> <span class="s1">&#39;error/404&#39;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">);</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="controllers-and-view-models">
<span id="zend-view-quick-start-usage-controllers"></span><h3>Controllers and View Models<a class="headerlink" href="#controllers-and-view-models" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">Zend\View\View</span></tt> consumes <tt class="docutils literal"><span class="pre">ViewModel</span></tt>s, passing them to the selected renderer. Where do you create these,
though?</p>
<p>The most explicit way is to create them in your controllers and return them.</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">namespace</span> <span class="nx">Foo\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Zend\Mvc\Controller\AbstractActionController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Zend\View\Model\ViewModel</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">BazBatController</span> <span class="k">extends</span> <span class="nx">AbstractActionController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">doSomethingCrazyAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ViewModel</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Hello world&#39;</span><span class="p">,</span>
        <span class="p">));</span>
        <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">setTemplate</span><span class="p">(</span><span class="s1">&#39;foo/baz-bat/do-something-crazy&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$view</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>This sets a &#8220;message&#8221; variable in the View Model, and sets the template name &#8220;foo/baz-bat/do-something-crazy&#8221;.
The View Model is then returned.</p>
<p>In most cases, you&#8217;ll likely have a template name based on the module namespace, controller, and action.
Considering that, and if you&#8217;re simply passing some variables, could this be made simpler? Definitely.</p>
<p>The MVC registers a couple of listeners for controllers to automate this. The first will look to see if you
returned an associative array from your controller; if so, it will create a View Model and make this associative
array the Variables Container; this View Model then replaces the <a class="reference internal" href="zend.mvc.mvc-event.html#zend-mvc-mvc-event"><em>MvcEvent</em></a>&#8216;s result.
It will also look to see if you returned nothing or null; if so, it will create a View Model without any variables
attached; this View Model also replaces the <tt class="docutils literal"><span class="pre">MvcEvent</span></tt>&#8216;s result.</p>
<p>The second listener checks to see if the <tt class="docutils literal"><span class="pre">MvcEvent</span></tt> result is a View Model, and, if so, if it has a template
associated with it. If not, it will inspect the controller matched during routing to determine the module namespace
and the controller class name, and, if available, it&#8217;s &#8220;action&#8221; parameter in order to create a template name.
This will be &#8220;module/controller/action&#8221;, all normalized to lowercase, dash-separated words.</p>
<p>As an example, the controller <tt class="docutils literal"><span class="pre">Foo\Controller\BazBatController</span></tt> with action &#8220;doSomethingCrazyAction&#8221;, would be mapped
to the template <tt class="docutils literal"><span class="pre">foo/baz-bat/do-something-crazy</span></tt>. As you can see, the words &#8220;Controller&#8221; and &#8220;Action&#8221; are omitted.</p>
<p>In practice, that means our previous example could be re-written as follows:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">namespace</span> <span class="nx">Foo\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Zend\Mvc\Controller\AbstractActionController</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">BazBatController</span> <span class="k">extends</span> <span class="nx">AbstractActionController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">doSomethingCrazyAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Hello world&#39;</span><span class="p">,</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>The above method will likely work for the majority of use cases. When you need to specify a different template,
explicitly create and return a View Model and specify the template manually, as in the first example.</p>
</div>
<div class="section" id="nesting-view-models">
<span id="zend-view-quick-start-usage-nesting"></span><h3>Nesting View Models<a class="headerlink" href="#nesting-view-models" title="Permalink to this headline">¶</a></h3>
<p>The other use case you may have for setting explicit View Models is if you wish to <strong>nest</strong> them.
In other words, you might want to render templates to be included within the main View you return.</p>
<p>As an example, you may want the View from an action to be one primary section that includes both an &#8220;article&#8221; and
a couple of sidebars; one of the sidebars may include content from multiple Views as well:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">namespace</span> <span class="nx">Content\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Zend\Mvc\Controller\AbstractActionController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Zend\View\Model\ViewModel</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ArticleController</span> <span class="k">extends</span> <span class="nx">AbstractActionController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">viewAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// get the article from the persistence layer, etc...</span>

        <span class="nv">$view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ViewModel</span><span class="p">();</span>

        <span class="c1">// this is not needed since it matches &quot;module/controller/action&quot;</span>
        <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">setTemplate</span><span class="p">(</span><span class="s1">&#39;content/article/view&#39;</span><span class="p">);</span>

        <span class="nv">$articleView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ViewModel</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;article&#39;</span> <span class="o">=&gt;</span> <span class="nv">$article</span><span class="p">));</span>
        <span class="nv">$articleView</span><span class="o">-&gt;</span><span class="na">setTemplate</span><span class="p">(</span><span class="s1">&#39;content/article&#39;</span><span class="p">);</span>

        <span class="nv">$primarySidebarView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ViewModel</span><span class="p">();</span>
        <span class="nv">$primarySidebarView</span><span class="o">-&gt;</span><span class="na">setTemplate</span><span class="p">(</span><span class="s1">&#39;content/main-sidebar&#39;</span><span class="p">);</span>

        <span class="nv">$secondarySidebarView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ViewModel</span><span class="p">();</span>
        <span class="nv">$secondarySidebarView</span><span class="o">-&gt;</span><span class="na">setTemplate</span><span class="p">(</span><span class="s1">&#39;content/secondary-sidebar&#39;</span><span class="p">);</span>

        <span class="nv">$sidebarBlockView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ViewModel</span><span class="p">();</span>
        <span class="nv">$sidebarBlockView</span><span class="o">-&gt;</span><span class="na">setTemplate</span><span class="p">(</span><span class="s1">&#39;content/block&#39;</span><span class="p">);</span>

        <span class="nv">$secondarySidebarView</span><span class="o">-&gt;</span><span class="na">addChild</span><span class="p">(</span><span class="nv">$sidebarBlockView</span><span class="p">,</span> <span class="s1">&#39;block&#39;</span><span class="p">);</span>

        <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">addChild</span><span class="p">(</span><span class="nv">$articleView</span><span class="p">,</span> <span class="s1">&#39;article&#39;</span><span class="p">)</span>
             <span class="o">-&gt;</span><span class="na">addChild</span><span class="p">(</span><span class="nv">$primarySidebarView</span><span class="p">,</span> <span class="s1">&#39;sidebar_primary&#39;</span><span class="p">)</span>
             <span class="o">-&gt;</span><span class="na">addChild</span><span class="p">(</span><span class="nv">$secondarySidebarView</span><span class="p">,</span> <span class="s1">&#39;sidebar_secondary&#39;</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$view</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>The above will create and return a View Model specifying the template &#8220;content/article/view&#8221;. When the View is rendered,
it will render three child Views, the <tt class="docutils literal"><span class="pre">$articleView</span></tt>, <tt class="docutils literal"><span class="pre">$primarySidebarView</span></tt>, and <tt class="docutils literal"><span class="pre">$secondarySidebarView</span></tt>;
these will be captured to the <tt class="docutils literal"><span class="pre">$view</span></tt>&#8216;s &#8220;article&#8221;, &#8220;sidebar_primary&#8221;, and &#8220;sidebar_secondary&#8221; variables,
respectively, so that when it renders, you may include that content. Additionally, the <tt class="docutils literal"><span class="pre">$secondarySidebarView</span></tt>
will include an additional View Model, <tt class="docutils literal"><span class="pre">$sidebarBlockView</span></tt>, which will be captured to its &#8220;block&#8221; view variable.</p>
<p>To better visualize this, let&#8217;s look at what the final content might look like, with comments detailing where each
nested view model is injected.</p>
<p>Here are the templates, rendered based on a 12-column grid:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span> <span class="c1">// &quot;content/article/view&quot; template ?&gt;</span>
<span class="o">&lt;!--</span> <span class="k">This</span> <span class="nx">is</span> <span class="nx">from</span> <span class="nx">the</span> <span class="nv">$view</span> <span class="nx">View</span> <span class="nx">Model</span><span class="p">,</span> <span class="k">and</span> <span class="nx">the</span> <span class="s2">&quot;content/article/view&quot;</span> <span class="nx">template</span> <span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="nx">div</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;row content&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;?</span><span class="nx">php</span> <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">article</span> <span class="cp">?&gt;</span><span class="x"></span>

<span class="x">    </span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">sidebar_primary</span> <span class="cp">?&gt;</span><span class="x"></span>

<span class="x">    </span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">sidebar_secondary</span> <span class="cp">?&gt;</span><span class="x"></span>
<span class="x">&lt;/div&gt;</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span> <span class="c1">// &quot;content/article&quot; template ?&gt;</span>
    <span class="o">&lt;!--</span> <span class="k">This</span> <span class="nx">is</span> <span class="nx">from</span> <span class="nx">the</span> <span class="nv">$articleView</span> <span class="nx">View</span> <span class="nx">Model</span><span class="p">,</span> <span class="k">and</span> <span class="nx">the</span> <span class="s2">&quot;content/article&quot;</span>
         <span class="nx">template</span> <span class="o">--&gt;</span>
    <span class="o">&lt;</span><span class="nx">article</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;span8&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;?</span><span class="nx">php</span> <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">escapeHtml</span><span class="p">(</span><span class="s1">&#39;article&#39;</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="x"></span>
<span class="x">    &lt;/article&gt;</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span> <span class="c1">// &quot;content/main-sidebar&quot; template ?&gt;</span>
    <span class="o">&lt;!--</span> <span class="k">This</span> <span class="nx">is</span> <span class="nx">from</span> <span class="nx">the</span> <span class="nv">$primarySidebarView</span> <span class="nx">View</span> <span class="nx">Model</span><span class="p">,</span> <span class="k">and</span> <span class="nx">the</span>
         <span class="s2">&quot;content/main-sidebar&quot;</span> <span class="nx">template</span> <span class="o">--&gt;</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;span2 sidebar&quot;</span><span class="o">&gt;</span>
        <span class="nx">sidebar</span> <span class="nx">content</span><span class="o">...</span>
    <span class="o">&lt;/</span><span class="nx">div</span><span class="o">&gt;</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span> <span class="c1">// &quot;content/secondary-sidebar template ?&gt;</span>
    <span class="o">&lt;!--</span> <span class="k">This</span> <span class="nx">is</span> <span class="nx">from</span> <span class="nx">the</span> <span class="nv">$secondarySidebarView</span> <span class="nx">View</span> <span class="nx">Model</span><span class="p">,</span> <span class="k">and</span> <span class="nx">the</span>
         <span class="s2">&quot;content/secondary-sidebar&quot;</span> <span class="nx">template</span> <span class="o">--&gt;</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;span2 sidebar pull-right&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;?</span><span class="nx">php</span> <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">block</span> <span class="cp">?&gt;</span><span class="x"></span>
<span class="x">    &lt;/div&gt;</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span> <span class="c1">// &quot;content/block template ?&gt;</span>
        <span class="o">&lt;!--</span> <span class="k">This</span> <span class="nx">is</span> <span class="nx">from</span> <span class="nx">the</span> <span class="nv">$sidebarBlockView</span> <span class="nx">View</span> <span class="nx">Model</span><span class="p">,</span> <span class="k">and</span> <span class="nx">the</span>
            <span class="s2">&quot;content/block&quot;</span> <span class="nx">template</span> <span class="o">--&gt;</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;block&quot;</span><span class="o">&gt;</span>
            <span class="nx">block</span> <span class="nx">content</span><span class="o">...</span>
        <span class="o">&lt;/</span><span class="nx">div</span><span class="o">&gt;</span>
</pre></div>
</td></tr></table></div>
<p>And here is the aggregate, generated content:</p>
<div class="highlight-html"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">&lt;!-- This is from the $view View Model, and the &quot;content/article/view&quot; template --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row content&quot;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- This is from the $articleView View Model, and the &quot;content/article&quot;</span>
<span class="c">         template --&gt;</span>
    <span class="nt">&lt;article</span> <span class="na">class=</span><span class="s">&quot;span8&quot;</span><span class="nt">&gt;</span>
        Lorem ipsum ....
    <span class="nt">&lt;/article&gt;</span>

    <span class="c">&lt;!-- This is from the $primarySidebarView View Model, and the</span>
<span class="c">         &quot;content/main-sidebar&quot; template --&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;span2 sidebar&quot;</span><span class="nt">&gt;</span>
        sidebar content...
    <span class="nt">&lt;/div&gt;</span>

    <span class="c">&lt;!-- This is from the $secondarySidebarView View Model, and the</span>
<span class="c">         &quot;content/secondary-sidebar&quot; template --&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;span2 sidebar pull-right&quot;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- This is from the $sidebarBlockView View Model, and the</span>
<span class="c">            &quot;content/block&quot; template --&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;block&quot;</span><span class="nt">&gt;</span>
            block content...
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</td></tr></table></div>
<p>As you can see, you can achieve very complex markup using nested Views, while simultaneously keeping the details of
rendering isolated from the Request/Response lifecycle of the controller.</p>
</div>
<div class="section" id="dealing-with-layouts">
<span id="zend-view-quick-start-usage-layouts"></span><h3>Dealing with Layouts<a class="headerlink" href="#dealing-with-layouts" title="Permalink to this headline">¶</a></h3>
<p>Most sites enforce a cohesive look-and-feel which we typically call the site&#8217;s &#8220;layout&#8221;. It includes the default
stylesheets and JavaScript necessary, if any, as well as the basic markup structure into which all site
content will be injected.</p>
<p>Within Zend Framework 2, layouts are handled via nesting of View Models (see the <a class="reference internal" href="#zend-view-quick-start-usage-nesting"><em>previous example</em></a> for examples of View Model nesting). The <tt class="docutils literal"><span class="pre">Zend\Mvc\View\Http\ViewManager</span></tt>
composes a View Model which acts as the &#8220;root&#8221; for nested View Models. As such, it should contain the skeleton
(or layout) template for the site. All other content is then rendered and captured to view variables of this root
View Model.</p>
<p>The <tt class="docutils literal"><span class="pre">ViewManager</span></tt> sets the layout template as &#8220;layout/layout&#8221; by default. To change this, you can add some
configuration to the &#8220;view_manager&#8221; area of your <a class="reference internal" href="#zend-view-quick-start-usage-config"><em>configuration</em></a>.</p>
<p>A listener on the controllers, <tt class="docutils literal"><span class="pre">Zend\Mvc\View\Http\InjectViewModelListener</span></tt>, will take a View Model returned from a
controller and inject it as a child of the root (layout) View Model. By default, View Models will capture to the
&#8220;content&#8221; variable of the root View Model. This means you can do the following in your layout view script:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;&lt;?</span><span class="nx">php</span> <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">headTitle</span><span class="p">()</span> <span class="cp">?&gt;</span><span class="x">&lt;/title&gt;</span>
<span class="x">    &lt;/head&gt;</span>
<span class="x">    &lt;body&gt;</span>
<span class="x">        </span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">content</span><span class="p">;</span> <span class="cp">?&gt;</span><span class="x"></span>
<span class="x">    &lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span>
</pre></div>
</td></tr></table></div>
<p>If you want to specify a different View variable for which to capture, explicitly create a view model in your
controller, and set its &#8220;capture to&#8221; value:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">namespace</span> <span class="nx">Foo\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Zend\Mvc\Controller\AbstractActionController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Zend\View\Model\ViewModel</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">BazBatController</span> <span class="k">extends</span> <span class="nx">AbstractActionController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">doSomethingCrazyAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ViewModel</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Hello world&#39;</span><span class="p">,</span>
        <span class="p">));</span>

        <span class="c1">// Capture to the layout view&#39;s &quot;article&quot; variable</span>
        <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">setCaptureTo</span><span class="p">(</span><span class="s1">&#39;article&#39;</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$view</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>There will be times you don&#8217;t want to render a layout. For example, you might be answering an API call which
expects JSON or an XML payload, or you might be answering an XHR request that expects a partial HTML payload. The
simplest way to do this is to explicitly create and return a view model from your controller, and mark it as
&#8220;terminal&#8221;, which will hint to the MVC listener that normally injects the returned View Model into the layout View
Model, to instead replace the layout view model.</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">namespace</span> <span class="nx">Foo\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Zend\Mvc\Controller\AbstractActionController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Zend\View\Model\ViewModel</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">BazBatController</span> <span class="k">extends</span> <span class="nx">AbstractActionController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">doSomethingCrazyAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ViewModel</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Hello world&#39;</span><span class="p">,</span>
        <span class="p">));</span>

        <span class="c1">// Disable layouts; `MvcEvent` will use this View Model instead</span>
        <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">setTerminal</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$view</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p><a class="reference internal" href="#zend-view-quick-start-usage-nesting"><em>When discussing nesting View Models</em></a>, we detailed a nested
View Model which contained an article and sidebars. Sometimes, you may want to provide additional View Models to
the layout, instead of nesting in the returned layout. This may be done by using the &#8220;layout&#8221; controller plugin,
which returns the root View Model. You can then call the same <tt class="docutils literal"><span class="pre">addChild()</span></tt> method on it as we did in that
previous example.</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">namespace</span> <span class="nx">Content\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Zend\Mvc\Controller\AbstractActionController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Zend\View\Model\ViewModel</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ArticleController</span> <span class="k">extends</span> <span class="nx">AbstractActionController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">viewAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// get the article from the persistence layer, etc...</span>

        <span class="c1">// Get the &quot;layout&quot; view model and inject a sidebar</span>
        <span class="nv">$layout</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">layout</span><span class="p">();</span>
        <span class="nv">$sidebarView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ViewModel</span><span class="p">();</span>
        <span class="nv">$sidebarView</span><span class="o">-&gt;</span><span class="na">setTemplate</span><span class="p">(</span><span class="s1">&#39;content/sidebar&#39;</span><span class="p">);</span>
        <span class="nv">$layout</span><span class="o">-&gt;</span><span class="na">addChild</span><span class="p">(</span><span class="nv">$sidebarView</span><span class="p">,</span> <span class="s1">&#39;sidebar&#39;</span><span class="p">);</span>

        <span class="c1">// Create and return a view model for the retrieved article</span>
        <span class="nv">$view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ViewModel</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;article&#39;</span> <span class="o">=&gt;</span> <span class="nv">$article</span><span class="p">));</span>
        <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">setTemplate</span><span class="p">(</span><span class="s1">&#39;content/article&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$view</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>You could also use this technique to select a different layout, by simply calling the <tt class="docutils literal"><span class="pre">setTemplate()</span></tt> method of
the layout View Model:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span class="c1">//In a controller</span>
<span class="k">namespace</span> <span class="nx">Content\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Zend\Mvc\Controller\AbstractActionController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Zend\View\Model\ViewModel</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ArticleController</span> <span class="k">extends</span> <span class="nx">AbstractActionController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">viewAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// get the article from the persistence layer, etc...</span>

        <span class="c1">// Get the &quot;layout&quot; view model and set an alternate template</span>
        <span class="nv">$layout</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">layout</span><span class="p">();</span>
        <span class="nv">$layout</span><span class="o">-&gt;</span><span class="na">setTemplate</span><span class="p">(</span><span class="s1">&#39;article/layout&#39;</span><span class="p">);</span>

        <span class="c1">// Create and return a view model for the retrieved article</span>
        <span class="nv">$view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ViewModel</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;article&#39;</span> <span class="o">=&gt;</span> <span class="nv">$article</span><span class="p">));</span>
        <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">setTemplate</span><span class="p">(</span><span class="s1">&#39;content/article&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$view</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Sometimes, you may want to access the layout from within your actual view scripts when using the <tt class="docutils literal"><span class="pre">PhpRenderer</span></tt>.
Reasons might include wanting to change the layout template or wanting to either access or inject layout view variables.
Similar to the &#8220;layout&#8221; controller plugin, you can use the &#8220;layout&#8221; View Helper. If you provide a string argument to it,
you will change the template; if you provide no arguments, the root layout View Model is returned.</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span class="c1">//In a view script</span>

<span class="c1">// Change the layout:</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">layout</span><span class="p">(</span><span class="s1">&#39;alternate/layout&#39;</span><span class="p">);</span> <span class="c1">// OR</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">layout</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">setTemplate</span><span class="p">(</span><span class="s1">&#39;alternate/layout&#39;</span><span class="p">);</span>

<span class="c1">// Access a layout variable.</span>
<span class="c1">// Since access to the base view model is relatively easy, it becomes a</span>
<span class="c1">// reasonable place to store things such as API keys, which other view scripts</span>
<span class="c1">// may need.</span>
<span class="nv">$layout</span>       <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">layout</span><span class="p">();</span>
<span class="nv">$disqusApiKey</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$layout</span><span class="o">-&gt;</span><span class="na">disqusApiKey</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$disqusApiKey</span> <span class="o">=</span> <span class="nv">$layout</span><span class="o">-&gt;</span><span class="na">disqusApiKey</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Set a layout variable</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">layout</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">footer</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;article/footer&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<p>Commonly, you may want to alter the layout based on the current <strong>module</strong>. This
requires (a) detecting if the controller matched in routing belongs to this module, and then (b) changing the
template of the View Model.</p>
<p>The place to do these actions is in a listener. It should listen either to the &#8220;route&#8221; event at low (negative)
priority, or on the &#8220;dispatch&#8221; event, at any priority. Typically, you will register this during the bootstrap
event.</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">namespace</span> <span class="nx">Content</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Module</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @param  \Zend\Mvc\MvcEvent $e The MvcEvent instance</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">onBootstrap</span><span class="p">(</span><span class="nv">$e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Register a dispatch event</span>
        <span class="nv">$app</span> <span class="o">=</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getParam</span><span class="p">(</span><span class="s1">&#39;application&#39;</span><span class="p">);</span>
        <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">getEventManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span><span class="s1">&#39;dispatch&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;setLayout&#39;</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @param  \Zend\Mvc\MvcEvent $e The MvcEvent instance</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setLayout</span><span class="p">(</span><span class="nv">$e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$matches</span>    <span class="o">=</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getRouteMatch</span><span class="p">();</span>
        <span class="nv">$controller</span> <span class="o">=</span> <span class="nv">$matches</span><span class="o">-&gt;</span><span class="na">getParam</span><span class="p">(</span><span class="s1">&#39;controller&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">false</span> <span class="o">===</span> <span class="nb">strpos</span><span class="p">(</span><span class="nv">$controller</span><span class="p">,</span> <span class="nx">__NAMESPACE__</span><span class="p">))</span> <span class="p">{</span>
            <span class="c1">// not a controller from this module</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Set the layout template</span>
        <span class="nv">$viewModel</span> <span class="o">=</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getViewModel</span><span class="p">();</span>
        <span class="nv">$viewModel</span><span class="o">-&gt;</span><span class="na">setTemplate</span><span class="p">(</span><span class="s1">&#39;content/layout&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="creating-and-registering-alternate-rendering-and-response-strategies">
<span id="zend-view-quick-start-usage-strategies"></span><h3>Creating and Registering Alternate Rendering and Response Strategies<a class="headerlink" href="#creating-and-registering-alternate-rendering-and-response-strategies" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">Zend\View\View</span></tt> does very little. Its workflow is essentially to martial a <tt class="docutils literal"><span class="pre">ViewEvent</span></tt>, and then trigger two
events, &#8220;renderer&#8221; and &#8220;response&#8221;. You can attach &#8220;strategies&#8221; to these events, using the methods
<tt class="docutils literal"><span class="pre">addRenderingStrategy()</span></tt> and <tt class="docutils literal"><span class="pre">addResponseStrategy()</span></tt>, respectively. A Rendering Strategy investigates the
Request object (or any other criteria) in order to select a Renderer (or fail to select one). A Response Strategy
determines how to populate the Response based on the result of rendering.</p>
<p>Zend Framework 2 ships with three Rendering and Response Strategies that you can use within your application.</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">Zend\View\Strategy\PhpRendererStrategy</span></tt>. This strategy is a &#8220;catch-all&#8221; in that it will always return the
<tt class="docutils literal"><span class="pre">Zend\View\Renderer\PhpRenderer</span></tt> and populate the Response body with the results of rendering.</li>
<li><tt class="docutils literal"><span class="pre">Zend\View\Strategy\JsonStrategy</span></tt>. This strategy inspects the Accept HTTP header, if present, and determines if
the client has indicated it accepts an &#8220;application/json&#8221; response. If so, it will return the
<tt class="docutils literal"><span class="pre">Zend\View\Renderer\JsonRenderer</span></tt>, and populate the Response body with the JSON value returned, as well as set
a Content-Type header with a value of &#8220;application/json&#8221;.</li>
<li><tt class="docutils literal"><span class="pre">Zend\View\Strategy\FeedStrategy</span></tt>. This strategy inspects the Accept HTTP header, if present, and determines if
the client has indicated it accepts either an &#8220;application/rss+xml&#8221; or &#8220;application/atom+xml&#8221; response. If so, it
will return the <tt class="docutils literal"><span class="pre">Zend\View\Renderer\FeedRenderer</span></tt>, setting the feed type to either &#8220;rss&#8221; or &#8220;atom&#8221;, based on
what was matched. Its Response strategy will populate the Response body with the generated feed, as well as set a
Content-Type header with the appropriate value based on feed type.</li>
</ul>
<p>By default, only the <tt class="docutils literal"><span class="pre">PhpRendererStrategy</span></tt> is registered, meaning you will need to register the other Strategies
yourself if you want to use them. Additionally, it means that you will likely want to register these at higher
priority to ensure they match before the <tt class="docutils literal"><span class="pre">PhpRendererStrategy</span></tt>. As an example, let&#8217;s register the <tt class="docutils literal"><span class="pre">JsonStrategy</span></tt>:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">namespace</span> <span class="nx">Application</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Module</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @param  \Zend\Mvc\MvcEvent $e The MvcEvent instance</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">onBootstrap</span><span class="p">(</span><span class="nv">$e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Register a &quot;render&quot; event, at high priority (so it executes prior</span>
        <span class="c1">// to the view attempting to render)</span>
        <span class="nv">$app</span> <span class="o">=</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getApplication</span><span class="p">();</span>
        <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">getEventManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span><span class="s1">&#39;render&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;registerJsonStrategy&#39;</span><span class="p">),</span> <span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @param  \Zend\Mvc\MvcEvent $e The MvcEvent instance</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">registerJsonStrategy</span><span class="p">(</span><span class="nv">$e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$app</span>          <span class="o">=</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getTarget</span><span class="p">();</span>
        <span class="nv">$locator</span>      <span class="o">=</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">getServiceManager</span><span class="p">();</span>
        <span class="nv">$view</span>         <span class="o">=</span> <span class="nv">$locator</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;Zend\View\View&#39;</span><span class="p">);</span>
        <span class="nv">$jsonStrategy</span> <span class="o">=</span> <span class="nv">$locator</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;ViewJsonStrategy&#39;</span><span class="p">);</span>

        <span class="c1">// Attach strategy, which is a listener aggregate, at high priority</span>
        <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">getEventManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span><span class="nv">$jsonStrategy</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>The above will register the <tt class="docutils literal"><span class="pre">JsonStrategy</span></tt> with the &#8220;render&#8221; event, such that it executes prior to the
<tt class="docutils literal"><span class="pre">PhpRendererStrategy</span></tt>, and thus ensure that a JSON payload is created when requested.</p>
<p>What if you want this to happen only in specific modules, or specific controllers? One way is similar to the last
example in the <a class="reference internal" href="#zend-view-quick-start-usage-layouts"><em>previous section on layouts</em></a>, where we detailed changing
the layout for a specific module:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">namespace</span> <span class="nx">Content</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Module</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @param  \Zend\Mvc\MvcEvent $e The MvcEvent instance</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">onBootstrap</span><span class="p">(</span><span class="nv">$e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Register a render event</span>
        <span class="nv">$app</span> <span class="o">=</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getParam</span><span class="p">(</span><span class="s1">&#39;application&#39;</span><span class="p">);</span>
        <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">getEventManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span><span class="s1">&#39;render&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;registerJsonStrategy&#39;</span><span class="p">),</span> <span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @param  \Zend\Mvc\MvcEvent $e The MvcEvent instance</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">registerJsonStrategy</span><span class="p">(</span><span class="nv">$e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$matches</span>    <span class="o">=</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getRouteMatch</span><span class="p">();</span>
        <span class="nv">$controller</span> <span class="o">=</span> <span class="nv">$matches</span><span class="o">-&gt;</span><span class="na">getParam</span><span class="p">(</span><span class="s1">&#39;controller&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">false</span> <span class="o">===</span> <span class="nb">strpos</span><span class="p">(</span><span class="nv">$controller</span><span class="p">,</span> <span class="nx">__NAMESPACE__</span><span class="p">))</span> <span class="p">{</span>
            <span class="c1">// not a controller from this module</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Potentially, you could be even more selective at this point, and test</span>
        <span class="c1">// for specific controller classes, and even specific actions or request</span>
        <span class="c1">// methods.</span>

        <span class="c1">// Set the JSON strategy when controllers from this module are selected</span>
        <span class="nv">$app</span>          <span class="o">=</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getTarget</span><span class="p">();</span>
        <span class="nv">$locator</span>      <span class="o">=</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">getServiceManager</span><span class="p">();</span>
        <span class="nv">$view</span>         <span class="o">=</span> <span class="nv">$locator</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;Zend\View\View&#39;</span><span class="p">);</span>
        <span class="nv">$jsonStrategy</span> <span class="o">=</span> <span class="nv">$locator</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;ViewJsonStrategy&#39;</span><span class="p">);</span>

        <span class="c1">// Attach strategy, which is a listener aggregate, at high priority</span>
        <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">getEventManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span><span class="nv">$jsonStrategy</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>While the above examples detail using the <tt class="docutils literal"><span class="pre">JsonStrategy</span></tt>, the same could be done for the <tt class="docutils literal"><span class="pre">FeedStrategy</span></tt>.</p>
<p>What if you want to use a custom renderer? Or if your app might allow a combination of JSON, Atom feeds, and HTML?
At this point, you&#8217;ll need to create your own custom strategies. Below is an example that appropriately loops
through the HTTP Accept header, and selects the appropriate Renderer based on what is matched first.</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">namespace</span> <span class="nx">Content\View</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Zend\EventManager\EventManagerInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Zend\EventManager\ListenerAggregateInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Zend\Feed\Writer\Feed</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Zend\View\Renderer\FeedRenderer</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Zend\View\Renderer\JsonRenderer</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Zend\View\Renderer\PhpRenderer</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AcceptStrategy</span> <span class="k">implements</span> <span class="nx">ListenerAggregateInterface</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$feedRenderer</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$jsonRenderer</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$listeners</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
    <span class="k">protected</span> <span class="nv">$phpRenderer</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span>
        <span class="nx">PhpRenderer</span> <span class="nv">$phpRenderer</span><span class="p">,</span>
        <span class="nx">JsonRenderer</span> <span class="nv">$jsonRenderer</span><span class="p">,</span>
        <span class="nx">FeedRenderer</span> <span class="nv">$feedRenderer</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">phpRenderer</span>  <span class="o">=</span> <span class="nv">$phpRenderer</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">jsonRenderer</span> <span class="o">=</span> <span class="nv">$jsonRenderer</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">feedRenderer</span> <span class="o">=</span> <span class="nv">$feedRenderer</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">attach</span><span class="p">(</span><span class="nx">EventManagerInterface</span> <span class="nv">$events</span><span class="p">,</span> <span class="nv">$priority</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="o">===</span> <span class="nv">$priority</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">listeners</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$events</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span><span class="s1">&#39;renderer&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;selectRenderer&#39;</span><span class="p">));</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">listeners</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$events</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span><span class="s1">&#39;response&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;injectResponse&#39;</span><span class="p">));</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">listeners</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$events</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span><span class="s1">&#39;renderer&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;selectRenderer&#39;</span><span class="p">),</span> <span class="nv">$priority</span><span class="p">);</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">listeners</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$events</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span><span class="s1">&#39;response&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;injectResponse&#39;</span><span class="p">),</span> <span class="nv">$priority</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">detach</span><span class="p">(</span><span class="nx">EventManagerInterface</span> <span class="nv">$events</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">listeners</span> <span class="k">as</span> <span class="nv">$index</span> <span class="o">=&gt;</span> <span class="nv">$listener</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$events</span><span class="o">-&gt;</span><span class="na">detach</span><span class="p">(</span><span class="nv">$listener</span><span class="p">))</span> <span class="p">{</span>
                <span class="nb">unset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">listeners</span><span class="p">[</span><span class="nv">$index</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @param  \Zend\Mvc\MvcEvent $e The MvcEvent instance</span>
<span class="sd">     * @return \Zend\View\Renderer\RendererInterface</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">selectRenderer</span><span class="p">(</span><span class="nv">$e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$request</span> <span class="o">=</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getRequest</span><span class="p">();</span>
        <span class="nv">$headers</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getHeaders</span><span class="p">();</span>

        <span class="c1">// No Accept header? return PhpRenderer</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$headers</span><span class="o">-&gt;</span><span class="na">has</span><span class="p">(</span><span class="s1">&#39;accept&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">phpRenderer</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$accept</span> <span class="o">=</span> <span class="nv">$headers</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;accept&#39;</span><span class="p">);</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$accept</span><span class="o">-&gt;</span><span class="na">getPrioritized</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$mediaType</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">===</span> <span class="nb">strpos</span><span class="p">(</span><span class="nv">$mediaType</span><span class="p">,</span> <span class="s1">&#39;application/json&#39;</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">jsonRenderer</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">===</span> <span class="nb">strpos</span><span class="p">(</span><span class="nv">$mediaType</span><span class="p">,</span> <span class="s1">&#39;application/rss+xml&#39;</span><span class="p">))</span> <span class="p">{</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">feedRenderer</span><span class="o">-&gt;</span><span class="na">setFeedType</span><span class="p">(</span><span class="s1">&#39;rss&#39;</span><span class="p">);</span>
                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">feedRenderer</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">===</span> <span class="nb">strpos</span><span class="p">(</span><span class="nv">$mediaType</span><span class="p">,</span> <span class="s1">&#39;application/atom+xml&#39;</span><span class="p">))</span> <span class="p">{</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">feedRenderer</span><span class="o">-&gt;</span><span class="na">setFeedType</span><span class="p">(</span><span class="s1">&#39;atom&#39;</span><span class="p">);</span>
                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">feedRenderer</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// Nothing matched; return PhpRenderer. Technically, we should probably</span>
        <span class="c1">// return an HTTP 415 Unsupported response.</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">phpRenderer</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @param  \Zend\Mvc\MvcEvent $e The MvcEvent instance</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">injectResponse</span><span class="p">(</span><span class="nv">$e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$renderer</span> <span class="o">=</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getRenderer</span><span class="p">();</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">();</span>
        <span class="nv">$result</span>   <span class="o">=</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$renderer</span> <span class="o">===</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">jsonRenderer</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// JSON Renderer; set content-type header</span>
            <span class="nv">$headers</span> <span class="o">=</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getHeaders</span><span class="p">();</span>
            <span class="nv">$headers</span><span class="o">-&gt;</span><span class="na">addHeaderLine</span><span class="p">(</span><span class="s1">&#39;content-type&#39;</span><span class="p">,</span> <span class="s1">&#39;application/json&#39;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$renderer</span> <span class="o">===</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">feedRenderer</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Feed Renderer; set content-type header, and export the feed if</span>
            <span class="c1">// necessary</span>
            <span class="nv">$feedType</span>  <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">feedRenderer</span><span class="o">-&gt;</span><span class="na">getFeedType</span><span class="p">();</span>
            <span class="nv">$headers</span>   <span class="o">=</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getHeaders</span><span class="p">();</span>
            <span class="nv">$mediatype</span> <span class="o">=</span> <span class="s1">&#39;application/&#39;</span>
                       <span class="o">.</span> <span class="p">((</span><span class="s1">&#39;rss&#39;</span> <span class="o">==</span> <span class="nv">$feedType</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;rss&#39;</span> <span class="o">:</span> <span class="s1">&#39;atom&#39;</span><span class="p">)</span>
                       <span class="o">.</span> <span class="s1">&#39;+xml&#39;</span><span class="p">;</span>
            <span class="nv">$headers</span><span class="o">-&gt;</span><span class="na">addHeaderLine</span><span class="p">(</span><span class="s1">&#39;content-type&#39;</span><span class="p">,</span> <span class="nv">$mediatype</span><span class="p">);</span>

            <span class="c1">// If the $result is a feed, export it</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$result</span> <span class="nx">instanceof</span> <span class="nx">Feed</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">export</span><span class="p">(</span><span class="nv">$feedType</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$renderer</span> <span class="o">!==</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">phpRenderer</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Not a renderer we support, therefor not our strategy. Return</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Inject the content</span>
        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setContent</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>This strategy would be registered just as we demonstrated registering the <tt class="docutils literal"><span class="pre">JsonStrategy</span></tt> earlier. You would also
need to define DI configuration to ensure the various renderers are injected when you retrieve the strategy from
the application&#8217;s locator instance.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/zf2_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Zend\View Quick Start</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#usage">Usage</a><ul>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
<li><a class="reference internal" href="#controllers-and-view-models">Controllers and View Models</a></li>
<li><a class="reference internal" href="#nesting-view-models">Nesting View Models</a></li>
<li><a class="reference internal" href="#dealing-with-layouts">Dealing with Layouts</a></li>
<li><a class="reference internal" href="#creating-and-registering-alternate-rendering-and-response-strategies">Creating and Registering Alternate Rendering and Response Strategies</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="zend.version.html"
                        title="previous chapter">Getting the Zend Framework Version</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="zend.view.renderer.php-renderer.html"
                        title="next chapter">The PhpRenderer</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li>
        <!--<a href="../_sources/modules/zend.view.quick-start.txt"-->
        <a href="https://github.com/zendframework/zf2-documentation/blob/master/docs/languages/en/modules/zend.view.quick-start.rst"
           rel="nofollow">Show Source</a></li>
    <li><a href="https://github.com/zendframework/zf2-documentation/edit/master/docs/languages/en/modules/zend.view.quick-start.rst"
           rel="nofollow">Edit Source</a>
    </li>
  </ul>
        <p style="font-size: 12px">
            Note: You need to stay logged into your <a href="http://www.github.com">GitHub account</a> to contribute to the documentation.
        </p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="zend.view.renderer.php-renderer.html" title="The PhpRenderer"
             >next</a> |</li>
        <li class="right" >
          <a href="zend.version.html" title="Getting the Zend Framework Version"
             >previous</a> |</li>
        <li><a href="../index.html">Zend Framework 2 2.3.0dev documentation</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2013, Zend Technologies Ltd..
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b3.
    </div>
<div id="edit-button">
    <img src="../_static/edit.gif" alt="Edit this document" title="Edit this document" onclick="javascript:$('#editor-trap').toggle();">
</div>
     
<div id="editor-trap">
    <h3>Edit this document</h3>

    <p>
        The source code of this file is hosted on GitHub. Everyone can
        update and fix errors in this document with few clicks -
        no downloads needed.
    <p>

    <ol>

        <li>
            Login with your <a href="http://www.github.com">GitHub</a> account.
        </li>

        <li>
            Go to
            <a href="https://github.com/zendframework/zf2-documentation/edit/master/docs/languages/en/modules/zend.view.quick-start.rst">
                Zend\View Quick Start
            </a> on GitHub.
        </li>

        <li>
            Edit file contents using GitHub's text editor in your web browser
        </li>

        <li>
            Fill in the <b>Commit message</b> text box at the end of the page telling <i>why</i>
            you did the changes. Press <b>Propose file change</b> button next to it when done.
        </li>


        <li>
            On <i>Send a pull request</i> page you don't need to fill in text anymore. Just
            press <b>Send pull request</b> button.
        </li>

        <li>
            Your changes are now queued for review under project's <a href="https://github.com/zendframework/zf2-documentation/pulls">Pull requests</a> tab on GitHub.
        </li>
    </ol>

</div>


  </body>
</html>