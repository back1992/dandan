<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Searching an Index &mdash; Zend Framework 2 2.3.0dev documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.3.0dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Zend Framework 2 2.3.0dev documentation" href="../index.html" />
<style type="text/css">
    /* Styles for floating Edit on GitHub box */
    #editor-trap {
        padding: 1em;
        border: 1px solid white;
        width: 250px;

        display: none;
        color: white;
        background: #3f454b;
        position: fixed;
        bottom: 5px;
        left: 175px;
        font-size: 85%;
        text-align: left;
        z-index: 2;

        box-shadow: 0 4px 6px #333;
        -moz-box-shadow: 0 4px 6px #333;
        -webkit-box-shadow: 0 4px 6px #333;
        
        cursor: pointer;
    }

    #editor-trap h3 {
        margin: 0 0 0.5em 0;
        padding: 0;
    }

    #editor-trap h3 > span {
        padding: 0 6px;
        border: solid white;
        border-width: 0 1px 4px 1px;
        font-size: 10px;
    }

    #editor-trap a {
        color: #98DBCC;
    }

    #editor-trap ol {
        margin: 0;
        padding: 0 0 0 2em;
    }

    /* Hide trick */
    #editor-trap.toggled > * {
        display: none;
    }


    #editor-trap.toggled > h3 {
        display: block;
    }

    #editor-trap.toggled > h3 > span {
        border-width: 6px 1px 0 1px;
    }
    
    #edit-button {
        position: fixed;
        bottom: 5px;
        left: 5px;
        z-index: 2;
        width: 162px;
        height: 42px;
    }
</style>

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../index.html">Zend Framework 2 2.3.0dev documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="searching-an-index">
<span id="zendsearch-lucene-searching"></span><h1>Searching an Index<a class="headerlink" href="#searching-an-index" title="Permalink to this headline">¶</a></h1>
<div class="section" id="building-queries">
<span id="zendsearch-lucene-searching-query-building"></span><h2>Building Queries<a class="headerlink" href="#building-queries" title="Permalink to this headline">¶</a></h2>
<p>There are two ways to search the index. The first method uses query parser to construct a query from a string. The
second is to programmatically create your own queries through the <tt class="docutils literal"><span class="pre">Zend\Search\Lucene</span></tt> <em>API</em>.</p>
<p>Before choosing to use the provided query parser, please consider the following:</p>
<blockquote>
<div><dl class="docutils">
<dt>. If you are programmatically creating a query string and then parsing it with the query parser then you should</dt>
<dd>consider building your queries directly with the query <em>API</em>. Generally speaking, the query parser is designed
for human-entered text, not for program-generated text.</dd>
<dt>. Untokenized fields are best added directly to queries and not through the query parser. If a field&#8217;s values</dt>
<dd>are generated programmatically by the application, then the query clauses for this field should also be
constructed programmatically. An analyzer, which the query parser uses, is designed to convert human-entered
text to terms. Program-generated values, like dates, keywords, etc., should be added with the query <em>API</em>.</dd>
<dt>. In a query form, fields that are general text should use the query parser. All others, such as date ranges,</dt>
<dd>keywords, etc., are better added directly through the query <em>API</em>. A field with a limited set of values that
can be specified with a pull-down menu should not be added to a query string that is subsequently parsed but
instead should be added as a TermQuery clause.</dd>
<dt>. Boolean queries allow the programmer to logically combine two or more queries into new one. Thus it&#8217;s the best</dt>
<dd>way to add additional criteria to a search defined by a query string.</dd>
</dl>
</div></blockquote>
<p>Both ways use the same <em>API</em> method to search through the index:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$index</span> <span class="o">=</span> <span class="nx">Zend\Search\Lucene</span><span class="o">::</span><span class="na">open</span><span class="p">(</span><span class="s1">&#39;/data/my_index&#39;</span><span class="p">);</span>

<span class="nv">$index</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<p>The <tt class="docutils literal"><span class="pre">Zend\Search\Lucene::find()</span></tt> method determines the input type automatically and uses the query parser to
construct an appropriate <tt class="docutils literal"><span class="pre">Zend\Search\Lucene\Search\Query</span></tt> object from an input of type string.</p>
<p>It is important to note that the query parser uses the standard analyzer to tokenize separate parts of query
string. Thus all transformations which are applied to indexed text are also applied to query strings.</p>
<p>The standard analyzer may transform the query string to lower case for case-insensitivity, remove stop-words, and
stem among other transformations.</p>
<p>The <em>API</em> method doesn&#8217;t transform or filter input terms in any way. It&#8217;s therefore more suitable for computer
generated or untokenized fields.</p>
<div class="section" id="query-parsing">
<span id="zendsearch-lucene-searching-query-building-parsing"></span><h3>Query Parsing<a class="headerlink" href="#query-parsing" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">Zend\Search\Lucene\Search\QueryParser::parse()</span></tt> method may be used to parse query strings into query objects.</p>
<p>This query object may be used in query construction <em>API</em> methods to combine user entered queries with
programmatically generated queries.</p>
<p>Actually, in some cases it&#8217;s the only way to search for values within untokenized fields:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$userQuery</span> <span class="o">=</span> <span class="nx">Zend\Search\Lucene\Search\QueryParser</span><span class="o">::</span><span class="na">parse</span><span class="p">(</span><span class="nv">$queryStr</span><span class="p">);</span>

<span class="nv">$pathTerm</span>  <span class="o">=</span> <span class="k">new</span> <span class="nx">Zend\Search\Lucene\Index\Term</span><span class="p">(</span>
                     <span class="s1">&#39;/data/doc_dir/&#39;</span> <span class="o">.</span> <span class="nv">$filename</span><span class="p">,</span> <span class="s1">&#39;path&#39;</span>
                 <span class="p">);</span>
<span class="nv">$pathQuery</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Zend\Search\Lucene\Search\Query\Term</span><span class="p">(</span><span class="nv">$pathTerm</span><span class="p">);</span>

<span class="nv">$query</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Zend\Search\Lucene\Search\Query\Boolean</span><span class="p">();</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">addSubquery</span><span class="p">(</span><span class="nv">$userQuery</span><span class="p">,</span> <span class="k">true</span> <span class="cm">/* required */</span><span class="p">);</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">addSubquery</span><span class="p">(</span><span class="nv">$pathQuery</span><span class="p">,</span> <span class="k">true</span> <span class="cm">/* required */</span><span class="p">);</span>

<span class="nv">$hits</span> <span class="o">=</span> <span class="nv">$index</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<p><tt class="docutils literal"><span class="pre">Zend\Search\Lucene\Search\QueryParser::parse()</span></tt> method also takes an optional encoding parameter, which can
specify query string encoding:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$userQuery</span> <span class="o">=</span> <span class="nx">Zend\Search\Lucene\Search\QueryParser</span><span class="o">::</span><span class="na">parse</span><span class="p">(</span><span class="nv">$queryStr</span><span class="p">,</span>
                                                          <span class="s1">&#39;iso-8859-5&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<p>If the encoding parameter is omitted, then current locale is used.</p>
<p>It&#8217;s also possible to specify the default query string encoding with
<tt class="docutils literal"><span class="pre">Zend\Search\Lucene\Search\QueryParser::setDefaultEncoding()</span></tt> method:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="nx">Zend\Search\Lucene\Search\QueryParser</span><span class="o">::</span><span class="na">setDefaultEncoding</span><span class="p">(</span><span class="s1">&#39;iso-8859-5&#39;</span><span class="p">);</span>
<span class="o">...</span>
<span class="nv">$userQuery</span> <span class="o">=</span> <span class="nx">Zend\Search\Lucene\Search\QueryParser</span><span class="o">::</span><span class="na">parse</span><span class="p">(</span><span class="nv">$queryStr</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<p><tt class="docutils literal"><span class="pre">Zend\Search\Lucene\Search\QueryParser::getDefaultEncoding()</span></tt> returns the current default query string encoding
(the empty string means &#8220;current locale&#8221;).</p>
</div>
</div>
<div class="section" id="search-results">
<span id="zendsearch-lucene-searching-results"></span><h2>Search Results<a class="headerlink" href="#search-results" title="Permalink to this headline">¶</a></h2>
<p>The search result is an array of <tt class="docutils literal"><span class="pre">Zend\Search\Lucene\Search\QueryHit</span></tt> objects. Each of these has two properties:
<em>$hit-&gt;id</em> is a document number within the index and <em>$hit-&gt;score</em> is a score of the hit in a search result. The
results are ordered by score (descending from highest score).</p>
<p>The <tt class="docutils literal"><span class="pre">Zend\Search\Lucene\Search\QueryHit</span></tt> object also exposes each field of the <tt class="docutils literal"><span class="pre">Zend\Search\Lucene\Document</span></tt>
found in the search as a property of the hit. In the following example, a hit is returned with two fields from the
corresponding document: title and author.</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$index</span> <span class="o">=</span> <span class="nx">Zend\Search\Lucene</span><span class="o">::</span><span class="na">open</span><span class="p">(</span><span class="s1">&#39;/data/my_index&#39;</span><span class="p">);</span>

<span class="nv">$hits</span> <span class="o">=</span> <span class="nv">$index</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$hits</span> <span class="k">as</span> <span class="nv">$hit</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$hit</span><span class="o">-&gt;</span><span class="na">score</span><span class="p">;</span>
    <span class="k">echo</span> <span class="nv">$hit</span><span class="o">-&gt;</span><span class="na">title</span><span class="p">;</span>
    <span class="k">echo</span> <span class="nv">$hit</span><span class="o">-&gt;</span><span class="na">author</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Stored fields are always returned in UTF-8 encoding.</p>
<p>Optionally, the original <tt class="docutils literal"><span class="pre">Zend\Search\Lucene\Document</span></tt> object can be returned from the
<tt class="docutils literal"><span class="pre">Zend\Search\Lucene\Search\QueryHit</span></tt>. You can retrieve stored parts of the document by using the
<tt class="docutils literal"><span class="pre">getDocument()</span></tt> method of the index object and then get them by <tt class="docutils literal"><span class="pre">getFieldValue()</span></tt> method:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$index</span> <span class="o">=</span> <span class="nx">Zend\Search\Lucene</span><span class="o">::</span><span class="na">open</span><span class="p">(</span><span class="s1">&#39;/data/my_index&#39;</span><span class="p">);</span>

<span class="nv">$hits</span> <span class="o">=</span> <span class="nv">$index</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$hits</span> <span class="k">as</span> <span class="nv">$hit</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// return Zend\Search\Lucene\Document object for this hit</span>
    <span class="k">echo</span> <span class="nv">$document</span> <span class="o">=</span> <span class="nv">$hit</span><span class="o">-&gt;</span><span class="na">getDocument</span><span class="p">();</span>

    <span class="c1">// return a Zend\Search\Lucene\Field object</span>
    <span class="c1">// from the Zend\Search\Lucene\Document</span>
    <span class="k">echo</span> <span class="nv">$document</span><span class="o">-&gt;</span><span class="na">getField</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">);</span>

    <span class="c1">// return the string value of the Zend\Search\Lucene\Field object</span>
    <span class="k">echo</span> <span class="nv">$document</span><span class="o">-&gt;</span><span class="na">getFieldValue</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">);</span>

    <span class="c1">// same as getFieldValue()</span>
    <span class="k">echo</span> <span class="nv">$document</span><span class="o">-&gt;</span><span class="na">title</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>The fields available from the <tt class="docutils literal"><span class="pre">Zend\Search\Lucene\Document</span></tt> object are determined at the time of indexing. The
document fields are either indexed, or index and stored, in the document by the indexing application (e.g.
LuceneIndexCreation.jar).</p>
<p>Note that the document identity (&#8216;path&#8217; in our example) is also stored in the index and must be retrieved from it.</p>
</div>
<div class="section" id="limiting-the-result-set">
<span id="zendsearch-lucene-searching-results-limiting"></span><h2>Limiting the Result Set<a class="headerlink" href="#limiting-the-result-set" title="Permalink to this headline">¶</a></h2>
<p>The most computationally expensive part of searching is score calculation. It may take several seconds for large
result sets (tens of thousands of hits).</p>
<p><tt class="docutils literal"><span class="pre">Zend\Search\Lucene</span></tt> gives the possibility to limit result set size with <tt class="docutils literal"><span class="pre">getResultSetLimit()</span></tt> and
<tt class="docutils literal"><span class="pre">setResultSetLimit()</span></tt> methods:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$currentResultSetLimit</span> <span class="o">=</span> <span class="nx">Zend\Search\Lucene</span><span class="o">::</span><span class="na">getResultSetLimit</span><span class="p">();</span>

<span class="nx">Zend\Search\Lucene</span><span class="o">::</span><span class="na">setResultSetLimit</span><span class="p">(</span><span class="nv">$newLimit</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<p>The default value of 0 means &#8216;no limit&#8217;.</p>
<p>It doesn&#8217;t give the &#8216;best N&#8217; results, but only the &#8216;first N&#8217;<a class="footnote-reference" href="#id4" id="id1">[1]</a>.</p>
</div>
<div class="section" id="results-scoring">
<span id="zendsearch-lucene-searching-results-scoring"></span><h2>Results Scoring<a class="headerlink" href="#results-scoring" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">Zend\Search\Lucene</span></tt> uses the same scoring algorithms as Java Lucene. All hits in the search result are ordered
by score by default. Hits with greater score come first, and documents having higher scores should match the query
more precisely than documents having lower scores.</p>
<p>Roughly speaking, search hits that contain the searched term or phrase more frequently will have a higher score.</p>
<p>A hit&#8217;s score can be retrieved by accessing the <em>score</em> property of the hit:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$hits</span> <span class="o">=</span> <span class="nv">$index</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$hits</span> <span class="k">as</span> <span class="nv">$hit</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$hit</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">;</span>
    <span class="k">echo</span> <span class="nv">$hit</span><span class="o">-&gt;</span><span class="na">score</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>The <tt class="docutils literal"><span class="pre">Zend\Search\Lucene\Search\Similarity</span></tt> class is used to calculate the score for each hit. See
<a class="reference internal" href="zendsearch.lucene.extending.html#zendsearch-lucene-extending-scoring"><em>Extensibility. Scoring Algorithms</em></a> section for details.</p>
</div>
<div class="section" id="search-result-sorting">
<span id="zendsearch-lucene-searching-sorting"></span><h2>Search Result Sorting<a class="headerlink" href="#search-result-sorting" title="Permalink to this headline">¶</a></h2>
<p>By default, the search results are ordered by score. The programmer can change this behavior by setting a sort
field (or a list of fields), sort type and sort order parameters.</p>
<p><em>$index-&gt;find()</em> call may take several optional parameters:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$index</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="nv">$query</span> <span class="p">[,</span> <span class="nv">$sortField</span> <span class="p">[,</span> <span class="nv">$sortType</span> <span class="p">[,</span> <span class="nv">$sortOrder</span><span class="p">]]]</span>
                    <span class="p">[,</span> <span class="nv">$sortField2</span> <span class="p">[,</span> <span class="nv">$sortType</span> <span class="p">[,</span> <span class="nv">$sortOrder</span><span class="p">]]]</span>
             <span class="o">...</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<p>A name of stored field by which to sort result should be passed as the <tt class="docutils literal"><span class="pre">$sortField</span></tt> parameter.</p>
<p><tt class="docutils literal"><span class="pre">$sortType</span></tt> may be omitted or take the following enumerated values: <tt class="docutils literal"><span class="pre">SORT_REGULAR</span></tt> (compare items normally-
default value), <tt class="docutils literal"><span class="pre">SORT_NUMERIC</span></tt> (compare items numerically), <tt class="docutils literal"><span class="pre">SORT_STRING</span></tt> (compare items as strings).</p>
<p><tt class="docutils literal"><span class="pre">$sortOrder</span></tt> may be omitted or take the following enumerated values: <tt class="docutils literal"><span class="pre">SORT_ASC</span></tt> (sort in ascending order-
default value), <tt class="docutils literal"><span class="pre">SORT_DESC</span></tt> (sort in descending order).</p>
<p>Examples:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$index</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="nv">$query</span><span class="p">,</span> <span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="nx">SORT_NUMERIC</span><span class="p">,</span> <span class="nx">SORT_DESC</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$index</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="nv">$query</span><span class="p">,</span> <span class="s1">&#39;fname&#39;</span><span class="p">,</span> <span class="nx">SORT_STRING</span><span class="p">,</span> <span class="s1">&#39;lname&#39;</span><span class="p">,</span> <span class="nx">SORT_STRING</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$index</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="nv">$query</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="nx">SORT_STRING</span><span class="p">,</span> <span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="nx">SORT_NUMERIC</span><span class="p">,</span> <span class="nx">SORT_DESC</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<p>Please use caution when using a non-default search order; the query needs to retrieve documents completely from an
index, which may dramatically reduce search performance.</p>
</div>
<div class="section" id="search-results-highlighting">
<span id="zendsearch-lucene-searching-highlighting"></span><h2>Search Results Highlighting<a class="headerlink" href="#search-results-highlighting" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">Zend\Search\Lucene</span></tt> provides two options for search results highlighting.</p>
<p>The first one is utilizing <tt class="docutils literal"><span class="pre">Zend\Search\Lucene\Document\Html</span></tt> class (see <a class="reference internal" href="zendsearch.lucene.overview.html#zendsearch-lucene-index-creation-html-documents"><em>HTML documents section</em></a> for details) using the following methods:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">/**</span>
<span class="sd"> * Highlight text with specified color</span>
<span class="sd"> *</span>
<span class="sd"> * @param string|array $words</span>
<span class="sd"> * @param string $colour</span>
<span class="sd"> * @return string</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">highlight</span><span class="p">(</span><span class="nv">$words</span><span class="p">,</span> <span class="nv">$colour</span> <span class="o">=</span> <span class="s1">&#39;#66ffff&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">/**</span>
<span class="sd"> * Highlight text using specified View helper or callback function.</span>
<span class="sd"> *</span>
<span class="sd"> * @param string|array $words  Words to highlight. Words could be organized</span>
<span class="sd">                               using the array or string.</span>
<span class="sd"> * @param callback $callback   Callback method, used to transform</span>
<span class="sd">                               (highlighting) text.</span>
<span class="sd"> * @param array    $params     Array of additional callback parameters passed</span>
<span class="sd">                               through into it (first non-optional parameter</span>
<span class="sd">                               is an HTML fragment for highlighting)</span>
<span class="sd"> * @return string</span>
<span class="sd"> * @throws Zend\Search\Lucene\Exception</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">highlightExtended</span><span class="p">(</span><span class="nv">$words</span><span class="p">,</span> <span class="nv">$callback</span><span class="p">,</span> <span class="nv">$params</span> <span class="o">=</span> <span class="k">array</span><span class="p">())</span>
</pre></div>
</td></tr></table></div>
<p>To customize highlighting behavior use <tt class="docutils literal"><span class="pre">highlightExtended()</span></tt> method with specified callback, which takes one or
more parameters <a class="footnote-reference" href="#id5" id="id2">[2]</a>, or extend <tt class="docutils literal"><span class="pre">Zend\Search\Lucene\Document\Html</span></tt> class and redefine
<tt class="docutils literal"><span class="pre">applyColour($stringToHighlight,</span> <span class="pre">$colour)</span></tt> method used as a default highlighting callback. <a class="footnote-reference" href="#id6" id="id3">[3]</a></p>
<p><a class="reference internal" href="zend.view.helpers.html#zend-view-helpers"><em>View helpers</em></a> also can be used as callbacks in context of view script:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$doc</span><span class="o">-&gt;</span><span class="na">highlightExtended</span><span class="p">(</span><span class="s1">&#39;word1 word2 word3...&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;myViewHelper&#39;</span><span class="p">));</span>
</pre></div>
</td></tr></table></div>
<p>The result of highlighting operation is retrieved by <em>ZendSearchLuceneDocumentHtml-&gt;getHTML()</em> method.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Highlighting is performed in terms of current analyzer. So all forms of the word(s) recognized by analyzer are
highlighted.</p>
<p>E.g. if current analyzer is case insensitive and we request to highlight &#8216;text&#8217; word, then &#8216;text&#8217;, &#8216;Text&#8217;,
&#8216;TEXT&#8217; and other case combinations will be highlighted.</p>
<p>In the same way, if current analyzer supports stemming and we request to highlight &#8216;indexed&#8217;, then &#8216;index&#8217;,
&#8216;indexing&#8217;, &#8216;indices&#8217; and other word forms will be highlighted.</p>
<p class="last">On the other hand, if word is skipped by current analyzer (e.g. if short words filter is applied to the
analyzer), then nothing will be highlighted.</p>
</div>
<p>The second option is to use <em>ZendSearchLuceneSearchQuery-&gt;highlightMatches(string $inputHTML[, $defaultEncoding
= &#8216;UTF-8&#8217;[, ZendSearchLuceneSearchHighlighterInterface $highlighter]])</em> method:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$query</span> <span class="o">=</span> <span class="nx">Zend\Search\Lucene\Search\QueryParser</span><span class="o">::</span><span class="na">parse</span><span class="p">(</span><span class="nv">$queryStr</span><span class="p">);</span>
<span class="nv">$highlightedHTML</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">highlightMatches</span><span class="p">(</span><span class="nv">$sourceHTML</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<p>Optional second parameter is a default <em>HTML</em> document encoding. It&#8217;s used if encoding is not specified using
Content-type HTTP-EQUIV meta tag.</p>
<p>Optional third parameter is a highlighter object which has to implement
<tt class="docutils literal"><span class="pre">Zend\Search\Lucene\Search\Highlighter\Interface</span></tt> interface:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">interface</span> <span class="nx">Zend\Search\Lucene\Search\Highlighter\Interface</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Set document for highlighting.</span>
<span class="sd">     *</span>
<span class="sd">     * @param Zend\Search\Lucene\Document\Html $document</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setDocument</span><span class="p">(</span><span class="nx">Zend\Search\Lucene\Document\Html</span> <span class="nv">$document</span><span class="p">);</span>

    <span class="sd">/**</span>
<span class="sd">     * Get document for highlighting.</span>
<span class="sd">     *</span>
<span class="sd">     * @return Zend\Search\Lucene\Document\Html $document</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getDocument</span><span class="p">();</span>

    <span class="sd">/**</span>
<span class="sd">     * Highlight specified words (method is invoked once per subquery)</span>
<span class="sd">     *</span>
<span class="sd">     * @param string|array $words  Words to highlight. They could be</span>
<span class="sd">                                   organized using the array or string.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">highlight</span><span class="p">(</span><span class="nv">$words</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Where <tt class="docutils literal"><span class="pre">Zend\Search\Lucene\Document\Html</span></tt> object is an object constructed from the source <em>HTML</em> provided to the
<tt class="docutils literal"><span class="pre">Zend\Search\Lucene\Search\Query-&gt;highlightMatches()</span></tt> method.</p>
<p>If <tt class="docutils literal"><span class="pre">$highlighter</span></tt> parameter is omitted, then <tt class="docutils literal"><span class="pre">Zend\Search\Lucene\Search\Highlighter\Default</span></tt> class is
instantiated and used.</p>
<p>Highlighter <tt class="docutils literal"><span class="pre">highlight()</span></tt> method is invoked once per subquery, so it has an ability to differentiate highlighting
for them.</p>
<p>Actually, default highlighter does this walking through predefined color table. So you can implement your own
highlighter or just extend the default and redefine color table.</p>
<p><em>ZendSearchLuceneSearchQuery-&gt;htmlFragmentHighlightMatches()</em> has similar behavior. The only difference is that
it takes as an input and returns <em>HTML</em> fragment without &lt;&gt;HTML&gt;, &lt;HEAD&gt;, &lt;BODY&gt; tags. Nevertheless, fragment is
automatically transformed to valid <em>XHTML</em>.</p>
<table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Returned hits are still ordered by score or by the specified order, if given.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>The first is an <em>HTML</em> fragment for highlighting and others are callback behavior dependent. Returned value
is a highlighted <em>HTML</em> fragment.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td>In both cases returned <em>HTML</em> is automatically transformed into valid <em>XHTML</em>.</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/zf2_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Searching an Index</a><ul>
<li><a class="reference internal" href="#building-queries">Building Queries</a><ul>
<li><a class="reference internal" href="#query-parsing">Query Parsing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#search-results">Search Results</a></li>
<li><a class="reference internal" href="#limiting-the-result-set">Limiting the Result Set</a></li>
<li><a class="reference internal" href="#results-scoring">Results Scoring</a></li>
<li><a class="reference internal" href="#search-result-sorting">Search Result Sorting</a></li>
<li><a class="reference internal" href="#search-results-highlighting">Search Results Highlighting</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li>
        <!--<a href="../_sources/modules/zendsearch.lucene.searching.txt"-->
        <a href="https://github.com/zendframework/zf2-documentation/blob/master/docs/languages/en/modules/zendsearch.lucene.searching.rst"
           rel="nofollow">Show Source</a></li>
    <li><a href="https://github.com/zendframework/zf2-documentation/edit/master/docs/languages/en/modules/zendsearch.lucene.searching.rst"
           rel="nofollow">Edit Source</a>
    </li>
  </ul>
        <p style="font-size: 12px">
            Note: You need to stay logged into your <a href="http://www.github.com">GitHub account</a> to contribute to the documentation.
        </p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../index.html">Zend Framework 2 2.3.0dev documentation</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2013, Zend Technologies Ltd..
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b3.
    </div>
<div id="edit-button">
    <img src="../_static/edit.gif" alt="Edit this document" title="Edit this document" onclick="javascript:$('#editor-trap').toggle();">
</div>
     
<div id="editor-trap">
    <h3>Edit this document</h3>

    <p>
        The source code of this file is hosted on GitHub. Everyone can
        update and fix errors in this document with few clicks -
        no downloads needed.
    <p>

    <ol>

        <li>
            Login with your <a href="http://www.github.com">GitHub</a> account.
        </li>

        <li>
            Go to
            <a href="https://github.com/zendframework/zf2-documentation/edit/master/docs/languages/en/modules/zendsearch.lucene.searching.rst">
                Searching an Index
            </a> on GitHub.
        </li>

        <li>
            Edit file contents using GitHub's text editor in your web browser
        </li>

        <li>
            Fill in the <b>Commit message</b> text box at the end of the page telling <i>why</i>
            you did the changes. Press <b>Propose file change</b> button next to it when done.
        </li>


        <li>
            On <i>Send a pull request</i> page you don't need to fill in text anymore. Just
            press <b>Send pull request</b> button.
        </li>

        <li>
            Your changes are now queued for review under project's <a href="https://github.com/zendframework/zf2-documentation/pulls">Pull requests</a> tab on GitHub.
        </li>
    </ol>

</div>


  </body>
</html>